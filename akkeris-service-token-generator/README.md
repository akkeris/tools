# Akkeris Service Token Generator

## Instructions

Set your `kubectl` context to the cluster that your Akkeris installation is running in.

Run `source get_config.sh` to save the JWT private & public keys needed to generate a token as environment variables.

Set the following additional environment variables: 
 
 - `TOKEN_TTL`: Time that the token should be valid for (in seconds). Default is 86400 (24 hours in seconds = 60 * 60 * 24), but you could use 10 years (315360000) for a long-lived service token
 - `SERVICE_NAME`: Name of the service requesting the service token
 - `AKKERIS_API`: Endpoint of the Akkeris API (e.g. https://apps.yourdomain.io)

Then, run `npm run generate` to generate the service token.

### Example

```bash
source get_config.sh
TOKEN_TTL=86400 SERVICE_NAME=myservice AKKERIS_API=https://apps.yourdomain.io npm run verify
```

## Token Verification

To verify the generated token, you can run `npm run verify` with the following environment variables set:

- `JWT_RS256_PUBLIC_CERT`: This should come from `source get_config.sh` as described in the Instructions section
- `AKKERIS_API`: Endpoint of the Akkeris API (e.g. https://apps.yourdomain.io)
- `TOKEN`: Token generated by the generate script